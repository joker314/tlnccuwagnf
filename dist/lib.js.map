{"version":3,"sources":["lib.js"],"names":[],"mappings":"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","file":"lib.js","sourcesContent":["const interp = require('./interp')\nconst C = require('./constants')\nconst equal = require('deep-equal')\n\nexport class StringPrim {\n  constructor(str) {\n    this.str = str\n  }\n\n  set str(str) {\n    this._str = String(str)\n  }\n\n  get str() {\n    return String(this._str)\n  }\n\n  toString() {\n    return '<String ' + this.str + '>'\n  }\n}\n\nexport class BooleanPrim {\n  constructor(bool) {\n    this.bool = bool\n  }\n\n  set bool(bool) {\n    this._bool = Boolean(bool)\n  }\n\n  get bool() {\n    return Boolean(this._bool)\n  }\n\n  valueOf() {\n    return this.bool\n  }\n\n  toString() {\n    return `<Boolean ${this.bool}>`\n  }\n}\n\nexport class NumberPrim {\n  constructor(num) {\n    this.num = num\n  }\n\n  set num(num) {\n    this._num = Number(num)\n  }\n\n  get num() {\n    return Number(this._num)\n  }\n\n  valueOf() {\n    return this.num\n  }\n\n  toString() {\n    return '<Number ' + this.num + '>'\n  }\n}\n\n// Converting language primatives to JS prims ---------------------------------\n\nexport function toJString(str) {\n  if (str instanceof StringPrim) {\n    return str.str\n  } else {\n    return String(str)\n  }\n}\n\nexport function toJBoolean(bool) {\n  if (bool instanceof BooleanPrim && bool.bool === true) {\n    return true\n  } else {\n    return false\n  }\n}\n\nexport function toJNumber(num) {\n  if (num instanceof NumberPrim) {\n    return num.num\n  } else {\n    return Number(num)\n  }\n}\n\n// Converting JS prims to language primitives ---------------------------------\n\nexport function toLString(str) {\n  return new StringPrim(str)\n}\n\nexport function toLBoolean(bool) {\n  return new BooleanPrim(bool)\n}\n\nexport function toLNumber(num) {\n  return new NumberPrim(num)\n}\n\nexport function toLObject(data) {\n  let obj = new LObject()\n  for (let key in data) {\n    set(obj, key, data[key])\n  }\n  return obj\n}\n\n// Tree parsing stuff ---------------------------------------------------------\n\nexport function searchTreeFor(innerTree, searchFor, reject) {\n  for (let treeNode of innerTree) {\n    if (equal(treeNode, searchFor)) {\n      return true\n    }\n  }\n  for (let treeNode of innerTree.filter(n => n instanceof Array)\n        .filter(n => !(reject ? reject(n) : false))) {\n    if (searchTreeFor(treeNode, searchFor, reject)) {\n      return true\n    }\n  }\n  return false\n}\n\n// Call function --------------------------------------------------------------\n\nexport async function call(fn, args) {\n  return await fn['__call__'](args)\n}\n\nexport async function defaultCall(fnToken, args) {\n  if (fnToken.fn instanceof Function) {\n    // it's a javascript function so just call it\n    const argumentValues = []\n    for (let argument of args) {\n      argumentValues.push(await interp.evaluateExpression(\n        argument, fnToken.argumentScope))\n    }\n    let ret = fnToken.fn(argumentValues)\n    if (ret instanceof Promise) {\n      return await ret\n    } else {\n      return ret\n    }\n  } else {\n    // Might this function return anything? We can tell by if the `return`\n    // variable is referenced anywhere within the function's code. If so we\n    // need to do all sorts of promise-y things.\n    //\n    // Of course, this is all very hacky, and we would be better off using an\n    // \"async {}\" asynchronous function syntax...\n    /*\n    const isAsynchronous = searchTreeFor(\n      fnToken.fn, ['VARIABLE_IDENTIFIER', 'return'],\n      // New function literals get a new return, so ignore those\n      n => n[0] === 'FUNCTION_PRIM')\n    console.log('test:', isAsynchronous)\n    */\n    const isAsynchronous = fnToken.isAsynchronous\n\n    // Asynchronous things\n    let resolve\n    const donePromise = new Promise(function(_resolve) {\n      resolve = _resolve\n    })\n\n    // Not asynchronous things\n    let returnValue = null\n\n    const scope = Object.assign({}, fnToken.environment.vars)\n    scope.return = new Variable(new LFunction(function([val]) {\n      if (isAsynchronous) {\n        resolve(val)\n      } else {\n        returnValue = val\n      }\n    }))\n    const paramaters = fnToken.paramaterList\n    for (let i = 0; i < paramaters.length; i++) {\n      const value = args[i]\n      const paramater = paramaters[i]\n      if (paramater.type === 'normal') {\n        const evaluatedValue = await interp.evaluateExpression(value, fnToken.argumentScope)\n        scope[paramater.name] = new Variable(evaluatedValue)\n      } else if (paramater.type === 'unevaluated') {\n        scope[paramater.name] = new Variable(new LFunction(async function() {\n          return await interp.evaluateExpression(value, fnToken.argumentScope)\n        }))\n      }\n    }\n\n    const environment = new LEnvironment()\n    environment.comment = 'Calling environment'\n    environment.parentEnvironment = fnToken.environment.parentEnvironment\n    Object.assign(environment.vars, scope)\n\n    // Shorthand functions.. these aren't finished! They don't work with the\n    // whole async stuff. I think.\n    if (fnToken.isShorthand) {\n      return await interp.evaluateExpression(fnToken.fn, environment)\n    } else {\n      await interp.evaluateEachExpression(fnToken.fn, environment)\n      if (isAsynchronous) {\n        return await donePromise\n      } else {\n        return returnValue\n      }\n    }\n  }\n}\n\n// Has function ---------------------------------------------------------------\n\nexport function has(obj, key) {\n  return key in obj\n}\n\n// Get function ---------------------------------------------------------------\n\nexport function get(obj, key) {\n  return obj['__get__'](key)\n}\n\nexport function defaultGet(obj, key) {\n  let keyString = toJString(key)\n  if (obj.data.hasOwnProperty(keyString)) {\n    return obj.data[keyString]\n  } else {\n    let constructor = obj['__constructor__']\n    let prototype = constructor['__prototype__']\n    let current = constructor\n    while (current && prototype && !(key in prototype)) {\n      current = current['__super__']\n      prototype = current ? current['__prototype__'] : null\n    }\n    if (current) {\n      let value = prototype[keyString]\n      if (value instanceof LFunction) {\n        // I was going to just bind to obj, but that generally involves using\n        // the oh so terrible `this`.\n        // Instead it returns a function that calls the given function with\n        // obj as the first paramater.\n        return new LFunction(function(...args) {\n          return value.fn(obj, ...args)\n        })\n      }\n      return value\n    }\n  }\n}\n\n// Set function ---------------------------------------------------------------\n\nexport function set(obj, key, value) {\n  return obj['__set__'](key, value)\n}\n\nexport function defaultSet(obj, key, value) {\n  return obj.data[toJString(key)] = value\n}\n\n// Variable class -------------------------------------------------------------\n// * this should never *ever* be accessed through anywhere except set/get\n//   Variable functions\n// * takes one paramater, value, which is stored in inst.value and represents\n//   the value of the Variable\nexport class Variable {\n  constructor(value) {\n    this.value = value\n  }\n\n  toString() {\n    return '<Variable>'\n  }\n}\n\n// Base token class -----------------------------------------------------------\n// * doesn't do anything on its own\n// * use x instanceof Token to check if x is any kind of token\n\nexport class Token {\n  constructor() {}\n}\n\n// Object token class ---------------------------------------------------------\n\nexport class LObject extends Token {\n  constructor() {\n    super()\n    this.data = {}\n    this['__constructor__'] = LObject\n  }\n\n  __get__(key) {\n    return defaultGet(this, key)\n  }\n\n  __set__(key, value) {\n    return defaultSet(this, key, value)\n  }\n}\n\nexport class LArray extends LObject {\n  constructor() {\n    super()\n    this['__constructor__'] = LArray\n    this.data.length = 0\n  }\n}\n\n// Function token class -------------------------------------------------------\n// [[this needs to be rewritten]]\n// * takes one paramater, fn, which is stored in inst.fn and represents the\n//     function that will be called\n// * you can also set scopeVariables (using setScopeVariables), which is\n//     generally only used for internal creation of function expressions; it\n//     represents the closure Variables that can be accessed from within the\n//     function\n// * you can also set fnArguments (using setArguments), which is generally also\n//     only used for internal creation of function expressions; it tells what\n//     call arguments should be mapped to in the Variables context of running\n//     the code block\n// * use inst.__call__ to call the function (with optional arguments)\n\nexport class LFunction extends LObject {\n  constructor(fn, asynchronous) {\n    super()\n    this['__constructor__'] = LFunction\n    this.fn = fn\n    this.environment = null\n\n    this.unevaluatedArgs = []\n    this.normalArgs = []\n    if (asynchronous) this.isAsynchronous = true\n  }\n\n  __call__(args) {\n    // Call this function. By default uses defaultCall, but can be overriden\n    // by subclasses.\n    return defaultCall(this, args)\n  }\n\n  setParamaters(paramaterList) {\n    this.paramaterList = paramaterList\n  }\n\n  toString() {\n    return '<Function>'\n  }\n}\n\nlet environmentCount = 0\n\nexport class LEnvironment {\n  constructor() {\n    this['__constructor__'] = LEnvironment\n    this.vars = {}\n    this.breakToEnvironment = null\n    this.comment = ''\n    this.environmentNum = (environmentCount++)\n  }\n\n  addVars(variables) {\n    for (const name of Object.getOwnPropertyNames(variables)) {\n      this.vars[name] = variables[name]\n    }\n    // console.log('Des vars addid :)', Object.getOwnPropertyNames(variables))\n  }\n\n  __set__(variableName, value) {\n    this.vars[variableName] = new Variable(value)\n  }\n\n  __get__(variableName) {\n    return this.vars[variableName].value\n  }\n\n  toString() {\n    // return JSON.stringify(Object.keys(this.vars))\n    return `<Environment #${this.environmentNum} \"${this.comment}\">`\n  }\n}\n\n// ETC. that requires above definitions ---------------------------------------\n\nexport let LObjectPrototype = {}\n\nexport let LArrayPrototype = {\n  push: new LFunction(function(self, what) {\n    self.data[self.data.length] = what\n    self.data.length = self.data.length + 1\n  }),\n  pop: new LFunction(function(self) {\n    delete self.data[self.data.length - 1]\n    self.data.length = self.data.length - 1\n  })\n}\n\nexport let LFunctionPrototype = {\n  debug: new LFunction(function(self) {\n    console.log('** DEBUG **')\n    console.log(self.fn.toString())\n  })\n}\n\nLObject['__prototype__'] = LObjectPrototype\nLObject['__super__'] = null\n\nLArray['__prototype__'] = LArrayPrototype\nLArray['__super__'] = LObject\n\nLFunction['__prototype__'] = LFunctionPrototype\nLFunction['__super__'] = LObject\n"],"sourceRoot":"/source/"}